---
output: 
  html_document:
    code_folding: hide
title: "Seagrass coverage estimates"
---

# {.tabset}

Source code here: https://github.com/tbep-tech/seagrass-analysis

```{r setup, message = F, warning = F, results = 'hide', echo = TRUE}
knitr::opts_chunk$set(echo = TRUE, warning = F, message = F, echo = T, fig.path = 'figs/', fig.path = 'figures/')
box::use(
  units[set_units], 
  dplyr[...],
  sf[st_read, st_set_geometry, st_intersection, st_transform, st_crs, st_area], 
  downloadthis[download_this],
  here[...]
)
data(file = 'seagrass', package = 'tbeptools')
data(file = 'sgseg', package = 'tbeptools')
```

## All estimates 

```{r}
download_this(seagrass, 
  output_name = "sgests-all",
  output_extension = ".xlsx",
  button_label = "Download data",
  button_type = "warning",
  has_icon = TRUE,
  icon = "fa fa-save" 
  )

knitr::kable(seagrass, caption = 'All estimates for all segments, based on historical coverages used to report on annual progress toward recovery goals.')
```

[download figure](figures/seagrasscov.png)

```{r, out.width = '100%'}
knitr::include_graphics(here('figures/seagrasscov.png'))
```

## 2020 estimates

```{r}
load(file = here('data/sgdat2020.RData'))

bnds <- sgseg %>% 
  filter(segment %in% c('Boca Ciega Bay', 'Hillsborough Bay', 'Old Tampa Bay', 'Middle Tampa Bay',
                           'Lower Tampa Bay', 'Manatee River', 'Terra Ceia Bay'))

sgrs <- sgdat2020 %>% 
  st_transform(crs = st_crs(bnds)) %>% 
  filter(FLUCCSCODE %in% c(9113, 9116))

ests <- st_intersection(sgrs, bnds) %>% 
  mutate(area = st_area(.)) %>% 
  st_set_geometry(NULL) %>% 
  group_by(segment) %>% 
  summarise(area = sum(area)) %>% 
  mutate(
    Acres = as.numeric(set_units(area, 'acres')), 
    Hectares = as.numeric(set_units(area, 'hectares'))
  ) %>% 
  select(Segment = segment, Acres, Hectares)

download_this(ests, 
  output_name = "segment-ests-2020",
  output_extension = ".xlsx",
  button_label = "Download data",
  button_type = "warning",
  has_icon = TRUE,
  icon = "fa fa-save" 
  )

knitr::kable(ests, caption = '2020 bay segment coverage estimates, continous/patchy combined.', digits = 2)
```
